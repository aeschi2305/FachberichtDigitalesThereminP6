\subsection{Audio}\label{subsec:audio}

Die Kommunikation mit WM8731 Codec geschieht über die IP Componente Audi\_Video Configuration von Intel. Diese besitzt die Funktion 
\textit{alt\_up\_av\_config\_write\_audio\_cfg\_register} um die Kontrollregister des Codec über den Hardware Abstraction Layer (HAL) anzusprechen. \todo{Quelle Intel hinzufügen}.
Das Module \textbf{audio.c} beinhaltet die beiden Funktionen, \textit{codec\_wm8731\_init()} und \textit{set\_vol(vol\_gain)}. 

In der Initialisierung wird der Codec als Master konfiguriert \todo{Verweiss auf Dennis}. Der Clock des Codec wird auf \SI{12}{MHz} gesetzt und die Sampling Rate auf \SI{48}{kHz}. Die Input Audio Data Bit Länge wird auf 24 Bit gesetzt und der Übertragungsmodus der Daten auf left justified gesetzt. Mit diesen Einstellungen ist eine Kominikation mit der audio serializer Komponente möglich \todo{Verweiss auf Dennis}.
Um Störungen zu vermeiden sind die Line In Eingänge des Codec gemutet, da wir nur den Line Out brauchen. Der Linke und Rechte Kanal sind so eingestellt das beide Kanäle die selben Lautstärken haben\cite{codec}. 

Die Gesamtlautstärke des Theremin ist auf 10 unterschiedliche Pegel einbestellbar, dies geschieht mit dem Aufruf der Funktion \textit{set\_vol(vol\_gain)}. Die leiseste Stufe dämpft den Audio Signal Pegel um \SI{-76}{db}. Jeweils eine Stufe grösser reduziert die Dämpfung um \SI{7}{db}. Die höchste Stufe dämpft den Audio Signal Pegel um \SI{-7}{db}. Der Codec könnte gemäss Datenblatt das Signal bis +6dB verstärken. Nach Labor Tests haben wir uns entschieden das Audio Signal nur zu dämpfen, da eine Verstärkung zu laut ist.


Ursprünglich war geplant die Lautstärke Einstellung der Volume Antenne über den Codec zu steuern. Nicht wie in Kapitel \todo{Dennis} beschrieben über die VHDL Komponente. Diese Methode konnte jedoch nicht realisier werden, da die Zero Cross detection des Codec nicht funktionierte. Mit der Zero Cross Dedection sollte der Codec erst bei einem Nulldurchgang die Lautstärke vermindern oder erhöhen. In unseren Versuchen hat sich die Lautstärke jedoch nie geändert, obwohl ein Sinus Audio Signal angelegt wurde. Wir mussten feststellen das diese Methode für den DAC nicht funktioniert. Mit dieser Methode hätte die Lautstärke, verglichen zur realisierten Methode, eine bessere Dynamik gehabt. 